<!DOCTYPE>
<html>
<head>
	<meta charset="utf-8">
	<script src="http://code.jquery.com/jquery-latest.js"></script>
</head>
<body>

<p><button id="btn">点我点我啊！alert，不会弹出</button></p>
<p><button id="btn2">点我点我啊！alert2，虽然有alert和info，info执行，但是alert不弹出</button></p>
<p><button id="btninfo">点我点我啊！info可以</button></p>


<script type="text/javascript">

window.onload = function() {
  var $info = $('#info');
  function info(msg){
    var p = $('<p>'+msg+'</p>');
    $info.append(p);
  }

$( "#btn" ).on( "click", function() {
  openIos('itms-apps://', function(t){
      if(t){
        alert('timeout or no baidu APP');
      }else{
        alert('invoke success');
      }
    });
});

  $('#btn2').on("click", function(){
    openIos('itms-apps://', function(t){
      if(t){
        info('timeout or no baidu APP2');
        alert('timeout or no baidu APP2');
      }else{
        info('invoke success2');
        alert('invoke success2');
      }
    });
  });
  $('#btninfo').on("click", function(){
    openIos('itms-apps://', function(t){
      if(t){
        info('timeout or no baidu APP');
      }else{
        info('invoke success');
      }
    });
  });
}


function openIos(url, callback) {
	    if (!url) {
	        return;
	    }
	    var node = document.createElement('iframe');
	    node.style.display = 'none';
	    var body = document.body;
	    var timer;
	    var clear = function(evt, isTimeout) {
	       (typeof callback==='function') &&  callback(isTimeout);
	        window.removeEventListener('pagehide', hide, true);
	        window.removeEventListener('pageshow', hide, true);
	        if (!node) {
	            return;
	        }

	        node.onload = null;
	        body.removeChild(node);
	        node = null;

	    };
	    var hide = function(e){
	        clearTimeout(timer);
	        clear(e, false);
	    };
	    window.addEventListener('pagehide', hide, true);
	    window.addEventListener('pageshow', hide, true);
	    node.onload = clear;
	    node.src = url;
	    body.appendChild(node);
	    var now = +new Date();
	    //如果事件失败，则1秒设置为空
	    timer = setTimeout(function(){
	        timer = setTimeout(function(){
	          var newTime = +new Date();
	          if(now-newTime>1300){
	            clear(null, false);
	          }else{
	            clear(null, true);
	          }

	        }, 1200);
	    }, 60);
	}
	</script>
</body>
</html>
